<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SWIPENOW</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css" integrity="sha512-2SwdPD6INVrV/lHTZbO2nodKhrnDdJK9/kg2XD1r9uGqPo1cUbujc+IYdlYdEErWNu69gVcYgdxlmVmzTWnetw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="/styling/pages/profile.css">
    <link rel="stylesheet" href="/styling/responsive/profileresponsive.css">
    <link rel="stylesheet" href="/styling/heightResponsive/profileheightresponsive.css">

</head>
<body>
    <div class="container">
        <div class="header">
           <div class="primary">
            <img class="logo floating white-glow" src="/assests/logo-removebg-preview.png" alt="SWIPENOW Logo">
           <div class="primarysecond">

             <input type="text" placeholder="Search Friends">
             <button class="add" onclick="openAddPopup()">+</button>


            </div>
               
            
           
           </div>
           <div class="secondary">
           <img src="/assests/pfp/head1.png" class="pfp" id="profilePic">
           <p class="username" id="usernameText"></p>
           </div>
           <div class="flex">
           <div class="third">
              <div class="Score" id="scoreBox">3000<br>Score</div>
                 <div class="rank" id="rankBox"><br>Swipes</div>
                 <div class="streak" id="streakBox"><br>Streak</div>
           </div>
           <div class="fourth">
              <div class="friends" id="friendsBox"><br>Friends</div>
                 <div class="meme" id="memeBox"><br>Memes</div>
                 <div class="edit" onclick="goToEdit()">edit</div>
           </div>
           </div>
           </div>
          <div class="memebox">
         <div class="memes">
          <img src="/assests/memes/1500x900_164267-36758ad0cf0a0f2bbfd72ad324a6cb71.webp">
         </div>
         <div class="memes">
          <img src="/assests/memes/monkey-thinking-meme-template-27--kClqt8PzKNph-full.jpg">
         </div>
         <div class="memes">
          <img src="/assests/memes/supermeme_hero_image.png">
         </div>
          <div class="memes">
          <img src="/assests/memes/1500x900_164267-36758ad0cf0a0f2bbfd72ad324a6cb71.webp">
         </div>
         <div class="memes">
          <img src="/assests/memes/monkey-thinking-meme-template-27--kClqt8PzKNph-full.jpg">
         </div>
         <div class="memes">
          <img src="/assests/memes/supermeme_hero_image.png">
         </div>
          </div>
          



       

    
    <div class="footerNav">
  <div class="nav-item " onclick="setActiveNav(this)">
    <svg xmlns="http://www.w3.org/2000/svg" value="home"  viewBox="0 0 640 640"><!--!Font Awesome Free v7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2026 Fonticons, Inc.--><path d="M341.8 72.6C329.5 61.2 310.5 61.2 298.3 72.6L74.3 280.6C64.7 289.6 61.5 303.5 66.3 315.7C71.1 327.9 82.8 336 96 336L112 336L112 512C112 547.3 140.7 576 176 576L464 576C499.3 576 528 547.3 528 512L528 336L544 336C557.2 336 569 327.9 573.8 315.7C578.6 303.5 575.4 289.5 565.8 280.6L341.8 72.6zM304 384L336 384C362.5 384 384 405.5 384 432L384 528L256 528L256 432C256 405.5 277.5 384 304 384z"/></svg>
    <span class="dash"></span>
  </div>

  <div class="nav-item " onclick="setActiveNav(this)">
    <svg xmlns="http://www.w3.org/2000/svg" value="rank" viewBox="0 0 640 640"><!--!Font Awesome Free v7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2026 Fonticons, Inc.--><path d="M353.8 118.1L330.2 70.3C326.3 62 314.1 61.7 309.8 70.3L286.2 118.1L233.9 125.6C224.6 127 220.6 138.5 227.5 145.4L265.5 182.4L256.5 234.5C255.1 243.8 264.7 251 273.3 246.7L320.2 221.9L366.8 246.3C375.4 250.6 385.1 243.4 383.6 234.1L374.6 182L412.6 145.4C419.4 138.6 415.5 127.1 406.2 125.6L353.9 118.1zM288 320C261.5 320 240 341.5 240 368L240 528C240 554.5 261.5 576 288 576L352 576C378.5 576 400 554.5 400 528L400 368C400 341.5 378.5 320 352 320L288 320zM80 384C53.5 384 32 405.5 32 432L32 528C32 554.5 53.5 576 80 576L144 576C170.5 576 192 554.5 192 528L192 432C192 405.5 170.5 384 144 384L80 384zM448 496L448 528C448 554.5 469.5 576 496 576L560 576C586.5 576 608 554.5 608 528L608 496C608 469.5 586.5 448 560 448L496 448C469.5 448 448 469.5 448 496z"/></svg>
    <span class="dash"></span>
  </div>

  <div class="nav-item active" onclick="setActiveNav(this)">
   <svg xmlns="http://www.w3.org/2000/svg" value="profile" viewBox="0 0 640 640"><!--!Font Awesome Free v7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2026 Fonticons, Inc.--><path d="M320 312C386.3 312 440 258.3 440 192C440 125.7 386.3 72 320 72C253.7 72 200 125.7 200 192C200 258.3 253.7 312 320 312zM290.3 368C191.8 368 112 447.8 112 546.3C112 562.7 125.3 576 141.7 576L498.3 576C514.7 576 528 562.7 528 546.3C528 447.8 448.2 368 349.7 368L290.3 368z"/></svg>
    <span class="dash"></span>
  </div>
</div>

<div class="profile-overlay" id="profileOverlay">
  <div class="profile-card">

    <!-- CLOSE X -->
    <span class="close-x" onclick="closePopup()">âœ•</span>

    <!-- HEADER -->
    <div class="profile-header">
      <img src="/assests/pfp/2.png" class="pfp" />
      <p class="username" id="usernameTexts"></p>
    </div>

    <!-- STATS ROW 1 -->
    <div class="stats-row">
      <div class="stat-box" id="scoreBoxs"><br><span>Score</span></div>
      <div class="stat-box" id="rankBoxs">12<br><span>Swipes</span></div>
      <div class="stat-box" id="streakBoxs">ðŸ”¥50<br><span>Streak</span></div>
    </div>

    <!-- STATS ROW 2 -->
    <div class="stats-row">
      <div class="stat-box" id="friendsBoxs">45<br><span>Friends</span></div>
      <div class="stat-box" id="memeBoxs">3<br><span>Memes</span></div>

      <!-- ADD FRIEND -->
      <div class="stat-box add-friend" onclick="postUserData(this);">
        Add Friend
      </div>
    </div>

  </div>
</div>







<!-- ADD FRIEND POPUP -->
<div class="add-popup-overlay" id="addPopup">
  <div class="add-popup-card">
    <span class="close-x" onclick="closeAddPopup()">âœ•</span>

    <h3>Coming Soon</h3>
   <p>Soon you will be able to uplode your own memes</p>
  </div>
</div>

<script>
function openAddPopup() {
  document.getElementById("addPopup").style.display = "flex";
}

function closeAddPopup() {
  document.getElementById("addPopup").style.display = "none";
}

function addFriendFromPopup() {
  const input = document.getElementById("addFriendInput");
  const username = input.value.trim();

  if (!username) {
    alert("Enter a username");
    return;
  }

  // reuse your existing logic
  postUserData({
    value: username
  });

  input.value = "";
  closeAddPopup();
}
</script>





<script src="/scripting/utils/routing.js"></script>
  <script>
  const searchInput = document.querySelector(".primary input");
  const profileOverlay = document.getElementById("profileOverlay");

  // ENTER key (keyboard + mobile)
  searchInput.addEventListener("keydown", function (event) {
    if (event.key === "Enter") {
      event.preventDefault();

      const value = searchInput.value.trim();
      if (!value) return;

      // SHOW POPUP
      profileOverlay.style.display = "flex";
    }
  });

  function closePopup() {
    profileOverlay.style.display = "none";
  }

  function addFriend(el) {
    el.classList.toggle("added");
    el.textContent = el.classList.contains("added")
      ? "Added âœ“"
      : "Add Friend";
  }
</script>

<script>
document.addEventListener("DOMContentLoaded", loadProfile);

function loadProfile() {
  const username = sessionStorage.getItem("username");
  if (!username) {
    console.error("No session username found");
    return;
  }

  fetch(`http://localhost:8080/profile/${username}`)
    .then(res => {
      if (!res.ok) throw new Error("Failed to fetch profile");
      return res.json();
    })
    .then(data => updateUI(data))
    .catch(err => console.error(err));
}

function updateUI(user) {
  // PROFILE INFO
  document.getElementById("usernameText").textContent = `@${user.username}`;
  document.getElementById("profilePic").src = "/assests/pfp/3.png";

  // MAIN STATS
  document.getElementById("scoreBox").innerHTML =
    `${user.score}<br>Score`;

  document.getElementById("rankBox").innerHTML =
    `${user.swipes}<br>Swipes`;

  document.getElementById("streakBox").innerHTML =
    `${user.streak}ðŸ”¥<br>Streak`;

  // SECONDARY STATS
  document.getElementById("friendsBox").innerHTML =
    `${user.friends ||0}<br>Friends`;

  document.getElementById("memeBox").innerHTML =
    `${user.memes || 0}<br>Memes`;
}

// function goToEdit() {
//   window.location.href = "/edit-profile.html";
// }
</script>



<script>
const searchInputs = document.querySelector(".primary input");
const profileOverlays = document.getElementById("profileOverlay");
console.log(searchInput);

/* ===============================
   SEARCH USER PROFILE
================================ */

searchInputs.addEventListener("keydown", function (event) {
  if (event.key === "Enter") {
    event.preventDefault();

    const searchedUser = searchInputs.value.trim();
    if (!searchedUser) return;
     if(searchedUser != sessionStorage.getItem("username")){
      // alert("You cannot search yourself");
      fetchUserProfile(searchedUser);
      // return;
     }else{
      return;
     }
    
  }
});

function fetchUserProfile(username) {
  fetch(`http://localhost:8080/profile/${username}`)
    .then(res => {
      if (!res.ok) throw new Error("User not found");
      return res.json();
    })
    .then(data => {
      document.getElementById("usernameTexts").textContent = `@${data.username}`;
  // document.getElementById("profilePics").src = "/assests/pfp/3.png";

  // MAIN STATS
  document.getElementById("scoreBoxs").innerHTML =
    `${data.score}<br>Score`;

  document.getElementById("rankBoxs").innerHTML =
    `${data.swipes}<br>Swipes`;

  document.getElementById("streakBoxs").innerHTML =
    `${data.streak}ðŸ”¥<br>Streak`;

  // SECONDARY STATS
  document.getElementById("friendsBoxs").innerHTML =
    `${data.friends ||0}<br>Friends`;

  document.getElementById("memeBoxs").innerHTML =
    `${data.memes || 0}<br>Memes`;
      profileOverlays.style.display = "flex"; // show popup
    })
    .catch(err => {
      console.error(err);
      alert("User not found");
    });
}

/* ===============================
   UI HELPERS
================================ */

function closePopup() {
  profileOverlay.style.display = "none";
}


</script>


<script>
function postUserData(el) {
  const searchInput = document.querySelector(".primary input");
  const data = {
      friend1: sessionStorage.getItem("username"),
      friend2: searchInput.value.trim()
  };

  fetch("http://localhost:8080/add-friends", {
      method: "POST",
      headers: {"Content-Type": "application/json"},
      body: JSON.stringify(data)
  })
  .then(res => {
      if (!res.ok) throw new Error("Request failed");
      return res.json();
  })
  .then(response => {
      console.log("Server response:", response);
      el.classList.add("added");
      el.textContent = "Friends";
  })
  .catch(err => {
      console.error("POST error:", err);
      alert("Failed to add friend");
  });
}

</script>




<script>
  function fetchUserProfile(username) {
  fetch(`http://localhost:8080/profile/${username}`)
    .then(res => {
      if (!res.ok) throw new Error("User not found");
      return res.json();
    })
    .then(data => {
      document.getElementById("usernameTexts").textContent = `@${data.username}`;
      document.getElementById("scoreBoxs").innerHTML = `${data.score}<br>Score`;
      document.getElementById("rankBoxs").innerHTML = `${data.swipes}<br>Swipes`;
      document.getElementById("streakBoxs").innerHTML = `${data.streak}ðŸ”¥<br>Streak`;
      document.getElementById("friendsBoxs").innerHTML = `${data.friends ||0}<br>Friends`;
      document.getElementById("memeBoxs").innerHTML = `${data.memes || 0}<br>Memes`;

      // âœ… Check if already friends
      const myUsername = sessionStorage.getItem("username");
      if (username === myUsername) {
        // Searching yourself â†’ hide button
        document.querySelector(".add-friend").style.display = "none";
      } else {
        document.querySelector(".add-friend").style.display = "flex";
        checkFriendshipStatus(myUsername, username);
      }

      profileOverlay.style.display = "flex"; // show popup
    })
    .catch(err => {
      console.error(err);
      alert("User not found");
    });
}
function checkFriendshipStatus(myUsername, otherUsername) {
  fetch(`http://localhost:8080/friends/check?username1=${myUsername}&username2=${otherUsername}`)
    .then(res => res.json())
    .then(isFriend => {
      const addBtn = document.querySelector(".add-friend");
      if (isFriend) {
        addBtn.classList.add("added");
        addBtn.textContent = "Friends";
      } else {
        addBtn.classList.remove("added");
        addBtn.textContent = "Add Friend";
      }
    })
    .catch(err => console.error("Error checking friendship:", err));
}

</script>
</body>
</html>